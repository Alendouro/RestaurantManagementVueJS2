{"remainingRequest":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/babel-loader/lib/index.js!/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/src/pages/Manager/Invoice.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/src/pages/Manager/Invoice.vue","mtime":1546762763036},{"path":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/alendouro/WebDevelopment/RestaurantManagementVueJS2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport InvoiceAPI from \"../../packages/api/Invoice.js\";\nimport InvoiceItemsAPI from \"../../packages/api/InvoiceItems.js\";\nimport UsersAPI from \"../../packages/api/Users.js\";\nimport Multiselect from 'vue-multiselect';\nimport Datepicker from 'vuejs-datepicker';\nimport moment from 'moment';\nexport default {\n  components: {\n    Multiselect: Multiselect,\n    Datepicker: Datepicker\n  },\n  data: function data() {\n    return {\n      invoices: {\n        pending: [],\n        data: null,\n        filters: {\n          state: {\n            active: ['pending'],\n            options: ['paid', 'not paid', 'pending']\n          },\n          waiter: {\n            active: {\n              id: null,\n              name: null\n            },\n            options: [],\n            isLoading: false\n          },\n          date: {\n            date: null\n          }\n        },\n        selected: {\n          invoice: null,\n          items: null\n        }\n      }\n    };\n  },\n  methods: {\n    getInvoices: function getInvoices(filters, paginate, meal, waiter, page, date, waiterID) {\n      var _this = this;\n\n      InvoiceAPI.getInvoices(filters, paginate, meal, waiter, page, date, waiterID).then(function (r) {\n        _this.invoices.data = r.data;\n      });\n    },\n    getInvoiceItems: function getInvoiceItems(invoice) {\n      var _this2 = this;\n\n      this.invoices.selected.invoice = invoice; // Scroll to the bottom of the page\n\n      window.scrollTo(0, document.body.scrollHeight);\n      InvoiceItemsAPI.getInvoiceItems(invoice.id).then(function (items) {\n        items.data.forEach(function (item) {\n          console.log(item.name);\n        });\n        _this2.invoices.selected.items = items.data;\n      });\n    },\n    searchUsersInvoices: function searchUsersInvoices(searchQuery) {\n      var _this3 = this;\n\n      if (searchQuery.length < 3) {\n        return;\n      }\n\n      var options = [];\n      this.invoices.filters.waiter.isLoading = true;\n      UsersAPI.getSearchUser(searchQuery).then(function (r) {\n        _this3.invoices.filters.waiter.isLoading = false;\n        r.data.forEach(function (e) {\n          options.push({\n            id: e.id,\n            name: e.name\n          });\n        });\n      });\n      this.invoices.filters.waiter.options = options;\n    },\n    dataFilter: function dataFilter(date) {\n      var dateF = moment(date).format('YYYY-MM-DD');\n      this.meals.filters.date.date = dateF;\n      this.invoices.filters.date.date = dateF;\n      return dateF;\n    },\n    downloadInvoice: function downloadInvoice(invoiceID) {\n      InvoiceAPI.getDownloadPDF(invoiceID).then(function (r) {\n        if (r.status === 200) {\n          var blob = new Blob([r.data], {\n            type: 'application/pdf'\n          });\n          var link = document.createElement('a');\n          link.href = window.URL.createObjectURL(blob);\n          link.download = 'invoice_' + invoiceID + '.pdf';\n          link.click();\n          return;\n        }\n\n        toastr.error(\"There was an error while downloading your file\", \"ERROR\");\n      });\n    },\n    invoicesPaginate: function invoicesPaginate(direction) {\n      if (direction === 'last') {\n        this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active, true, true, true, this.invoices.data.current_page - 1, this.invoices.filters.date.date, this.invoices.filters.waiter.active.id);\n      } else {\n        this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active, true, true, true, this.invoices.data.current_page + 1, this.invoices.filters.date.date, this.invoices.filters.waiter.active.id);\n      }\n    }\n  },\n  created: function created() {\n    this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active, true, true, true, 1, null, null);\n  }\n};",{"version":3,"sources":["Invoice.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkHA,OAAA,UAAA,MAAA,+BAAA;AACA,OAAA,eAAA,MAAA,oCAAA;AACA,OAAA,QAAA,MAAA,6BAAA;AACA,OAAA,WAAA,MAAA,iBAAA;AACA,OAAA,UAAA,MAAA,kBAAA;AACA,OAAA,MAAA,MAAA,QAAA;AAEA,eAAA;AACA,cAAA;AAAA,4BAAA;AAAA;AAAA,GADA;AAEA,MAFA,kBAEA;AACA,WAAA;AACA,gBAAA;AACA,iBAAA,EADA;AAEA,cAAA,IAFA;AAGA,iBAAA;AACA,iBAAA;AACA,oBAAA,CAAA,SAAA,CADA;AAEA,qBAAA,CAAA,MAAA,EAAA,UAAA,EAAA,SAAA;AAFA,WADA;AAKA,kBAAA;AACA,oBAAA;AACA,kBAAA,IADA;AAEA,oBAAA;AAFA,aADA;AAKA,qBAAA,EALA;AAMA,uBAAA;AANA,WALA;AAaA,gBAAA;AACA,kBAAA;AADA;AAbA,SAHA;AAoBA,kBAAA;AACA,mBAAA,IADA;AAEA,iBAAA;AAFA;AApBA;AADA,KAAA;AA2BA,GA9BA;AAgCA,WAAA;AACA,eADA,uBACA,OADA,EACA,QADA,EACA,IADA,EACA,MADA,EACA,IADA,EACA,IADA,EACA,QADA,EACA;AAAA;;AACA,iBAAA,WAAA,CAAA,OAAA,EAAA,QAAA,EAAA,IAAA,EAAA,MAAA,EAAA,IAAA,EAAA,IAAA,EAAA,QAAA,EAAA,IAAA,CAAA,aAAA;AACA,cAAA,QAAA,CAAA,IAAA,GAAA,EAAA,IAAA;AACA,OAFA;AAGA,KALA;AAMA,mBANA,2BAMA,OANA,EAMA;AAAA;;AACA,WAAA,QAAA,CAAA,QAAA,CAAA,OAAA,GAAA,OAAA,CADA,CAGA;;AACA,aAAA,QAAA,CAAA,CAAA,EAAA,SAAA,IAAA,CAAA,YAAA;AAEA,sBAAA,eAAA,CAAA,QAAA,EAAA,EAAA,IAAA,CAAA,iBAAA;AACA,cAAA,IAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA;AACA,kBAAA,GAAA,CAAA,KAAA,IAAA;AACA,SAFA;AAGA,eAAA,QAAA,CAAA,QAAA,CAAA,KAAA,GAAA,MAAA,IAAA;AACA,OALA;AAMA,KAlBA;AAmBA,uBAnBA,+BAmBA,WAnBA,EAmBA;AAAA;;AACA,UAAA,YAAA,MAAA,GAAA,CAAA,EAAA;AACA;AACA;;AAEA,UAAA,UAAA,EAAA;AACA,WAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,SAAA,GAAA,IAAA;AAEA,eAAA,aAAA,CAAA,WAAA,EAAA,IAAA,CAAA,aAAA;AACA,eAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,SAAA,GAAA,KAAA;AACA,UAAA,IAAA,CAAA,OAAA,CAAA,aAAA;AACA,kBAAA,IAAA,CAAA;AACA,gBAAA,EAAA,EADA;AAEA,kBAAA,EAAA;AAFA,WAAA;AAIA,SALA;AAMA,OARA;AAUA,WAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,OAAA,GAAA,OAAA;AACA,KAtCA;AAuCA,cAvCA,sBAuCA,IAvCA,EAuCA;AACA,UAAA,QAAA,OAAA,IAAA,EAAA,MAAA,CAAA,YAAA,CAAA;AACA,WAAA,KAAA,CAAA,OAAA,CAAA,IAAA,CAAA,IAAA,GAAA,KAAA;AACA,WAAA,QAAA,CAAA,OAAA,CAAA,IAAA,CAAA,IAAA,GAAA,KAAA;AACA,aAAA,KAAA;AACA,KA5CA;AA6CA,mBA7CA,2BA6CA,SA7CA,EA6CA;AACA,iBAAA,cAAA,CAAA,SAAA,EAAA,IAAA,CAAA,aAAA;AACA,YAAA,EAAA,MAAA,KAAA,GAAA,EAAA;AACA,cAAA,OAAA,IAAA,IAAA,CAAA,CAAA,EAAA,IAAA,CAAA,EAAA;AAAA,kBAAA;AAAA,WAAA,CAAA;AACA,cAAA,OAAA,SAAA,aAAA,CAAA,GAAA,CAAA;AACA,eAAA,IAAA,GAAA,OAAA,GAAA,CAAA,eAAA,CAAA,IAAA,CAAA;AACA,eAAA,QAAA,GAAA,aAAA,SAAA,GAAA,MAAA;AACA,eAAA,KAAA;AACA;AACA;;AAEA,eAAA,KAAA,CAAA,gDAAA,EAAA,OAAA;AACA,OAXA;AAYA,KA1DA;AA2DA,oBA3DA,4BA2DA,SA3DA,EA2DA;AACA,UAAA,cAAA,MAAA,EAAA;AACA,aAAA,WAAA,CAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,CAAA,MAAA,KAAA,CAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,OAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,EACA,IADA,EACA,IADA,EACA,IADA,EACA,KAAA,QAAA,CAAA,IAAA,CAAA,YAAA,GAAA,CADA,EACA,KAAA,QAAA,CAAA,OAAA,CAAA,IAAA,CAAA,IADA,EACA,KAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EADA;AAEA,OAHA,MAGA;AACA,aAAA,WAAA,CAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,CAAA,MAAA,KAAA,CAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,OAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,EACA,IADA,EACA,IADA,EACA,IADA,EACA,KAAA,QAAA,CAAA,IAAA,CAAA,YAAA,GAAA,CADA,EACA,KAAA,QAAA,CAAA,OAAA,CAAA,IAAA,CAAA,IADA,EACA,KAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EADA;AAEA;AACA;AAnEA,GAhCA;AAsGA,SAtGA,qBAsGA;AACA,SAAA,WAAA,CAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,CAAA,MAAA,KAAA,CAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,OAAA,GAAA,KAAA,QAAA,CAAA,OAAA,CAAA,KAAA,CAAA,MAAA,EACA,IADA,EAEA,IAFA,EAGA,IAHA,EAIA,CAJA,EAKA,IALA,EAMA,IANA;AAQA;AA/GA,CAAA","sourcesContent":["<template>\n  <div class=\"content\">\n    <div class=\"md-layout\">\n      <div class=\"md-layout-item\">\n        <md-button class=\"md-info md-just-icon align-bottom-right\"\n                   v-show=\"(invoices.selected.invoice !== null ? invoices.selected.invoice.state === 'paid' : false)\"\n                   @click=\"downloadInvoice(invoices.selected.invoice.id)\"><md-icon >print</md-icon></md-button>\n        <h4><md-icon >filter_list</md-icon>Filters</h4>\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <label for=\"invoice_state\">State</label>\n            <multiselect :multiple=\"true\"\n                         v-model=\"invoices.filters.state.active\"\n                         :options=\"invoices.filters.state.options\"\n                         style=\"z-index: 9999;\" id=\"invoice_state\"></multiselect>\n          </div>\n          <div class=\"col-md-6\">\n            <label for=\"invoice_waiter\">Waiter</label>\n            <multiselect v-model=\"invoices.filters.waiter.active\"\n                         :options=\"invoices.filters.waiter.options\"\n                         @search-change=\"searchUsersInvoices\"\n                         :preserve-search=\"true\"\n                         :loading=\"invoices.filters.waiter.isLoading\"\n                         label=\"name\"\n                         track-by=\"name\"\n                         style=\"z-index: 9999;\" id=\"invoice_waiter\"></multiselect>\n          </div>\n        </div>\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <label for=\"invoice_date\">Date</label>\n            <datepicker class=\"form-control\" :format=\"dataFilter\" id=\"invoice_date\"></datepicker>\n          </div>\n        </div>\n        <div class=\"row mb-4\">\n          <div class=\"col-md-12\">\n            <md-button @click=\"getInvoices(invoices.filters.state.active.length === 0 ? invoices.filters.state.options : invoices.filters.state.active, true, true, true, 1, invoices.filters.date.date, invoices.filters.waiter.active.id)\"\n                       class=\"md-round md-block md-success\">FILTER</md-button>\n          </div>\n        </div>\n        <md-card v-if=\"this.invoices.data !== null\">\n          <md-card-header data-background-color=\"green\">\n            <h4 class=\"title\">Invoices</h4>\n            <h5 class=\"title\">Total: {{ invoices.data.total }}</h5>\n          </md-card-header>\n          <md-card-content>\n            <table class=\"table\">\n              <thead>\n              <tr>\n                <th>State</th>\n                <th>NIF</th>\n                <th>Name</th>\n                <th>Date</th>\n                <th>Total</th>\n                <th></th>\n              </tr>\n              </thead>\n              <tbody>\n              <tr v-for=\"invoice in invoices.data.data\" :key=\"invoice.id\">\n                <td class=\"pt-4\">{{ invoice.state }}</td>\n                <td class=\"pt-4\">{{ invoice.nif }}</td>\n                <td class=\"pt-4\">{{ invoice.name }}</td>\n                <td class=\"pt-4\">{{ moment(invoice.date).format('DD/MM/YYYY') }}</td>\n                <td class=\"pt-4\">{{ invoice.total_price }}€</td>\n                <td class=\"p-0\">\n                  <md-tooltip md-direction=\"top\">View invoice details</md-tooltip>\n                  <md-button class=\"md-block\" @click=\"getInvoiceItems(invoice)\"><md-icon>remove_red_eye</md-icon></md-button>\n                </td>\n              </tr>\n              </tbody>\n            </table>\n            <md-button :disabled=\"invoices.data.prev_page_url === null\" @click=\"invoicesPaginate('last')\">LAST</md-button>\n            <md-button :disabled=\"invoices.data.next_page_url === null\" @click=\"invoicesPaginate('next')\">NEXT</md-button>\n          </md-card-content>\n        </md-card>\n        <md-card v-if=\"invoices.selected.invoice !== null\" id=\"invoiceItems\">\n          <md-card-header data-background-color=\"green\" id=\"mealDetails\">\n            <h6 class=\"title\">Total: {{ invoices.selected.invoice.total_price }}€</h6>\n            <h6 class=\"title\">State: {{ invoices.selected.invoice.state }}</h6>\n            <h6 class=\"title\">Date: {{ moment(invoices.selected.invoice.created_at).format(\"DD/MM/YYYY\") }}</h6>\n            <h6 class=\"title\">Waiter: {{ invoices.selected.invoice.meal.waiter.name }}</h6>\n          </md-card-header>\n          <md-card-content>\n            <table class=\"table\">\n              <thead>\n              <tr>\n                <th>#</th>\n                <th>Item</th>\n                <th>Type</th>\n                <th>Quantity</th>\n                <th>Unit price</th>\n                <th>Sub total</th>\n              </tr>\n              </thead>\n              <tbody>\n              <tr v-for=\"(item, index) in invoices.selected.items\" :key=\"item.id\">\n                <td class=\"pt-4\">{{ index + 1 }}</td>\n                <td class=\"pt-4\">{{ item.item.name }}</td>\n                <td class=\"pt-4\">{{ item.item.type }}</td>\n                <td class=\"pt-4\">{{ item.quantity }}</td>\n                <td class=\"pt-4\">{{ item.unit_price }}€</td>\n                <td class=\"pt-4\">{{ item.sub_total_price }}€</td>\n              </tr>\n              </tbody>\n            </table>\n          </md-card-content>\n        </md-card>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport InvoiceAPI from \"../../packages/api/Invoice.js\";\nimport InvoiceItemsAPI from \"../../packages/api/InvoiceItems.js\";\nimport UsersAPI from \"../../packages/api/Users.js\";\nimport Multiselect from 'vue-multiselect'\nimport Datepicker from 'vuejs-datepicker';\nimport moment from 'moment';\n\nexport default {\n  components: { Multiselect, Datepicker },\n  data() {\n    return {\n      invoices: {\n        pending: [],\n        data: null,\n        filters:{\n          state:{\n            active: ['pending'],\n            options: ['paid', 'not paid', 'pending']\n          },\n          waiter:{\n            active: {\n              id: null,\n              name: null\n            },\n            options: [],\n            isLoading: false\n          },\n          date:{\n            date: null\n          }\n        },\n        selected: {\n          invoice: null,\n          items: null\n        }\n      },\n    }\n  },\n\n  methods: {\n    getInvoices(filters, paginate, meal, waiter, page, date, waiterID){\n      InvoiceAPI.getInvoices(filters, paginate, meal, waiter, page, date, waiterID).then(r => {\n        this.invoices.data = r.data;\n      });\n    },\n    getInvoiceItems(invoice){\n      this.invoices.selected.invoice = invoice;\n\n      // Scroll to the bottom of the page\n      window.scrollTo(0,document.body.scrollHeight);\n\n      InvoiceItemsAPI.getInvoiceItems(invoice.id).then(items => {\n        items.data.forEach(function(item){\n          console.log(item.name);\n        });\n        this.invoices.selected.items = items.data;\n      });\n    },\n    searchUsersInvoices(searchQuery){\n      if(searchQuery.length < 3){\n        return;\n      }\n\n      var options = [];\n      this.invoices.filters.waiter.isLoading = true;\n\n      UsersAPI.getSearchUser(searchQuery).then(r => {\n        this.invoices.filters.waiter.isLoading = false;\n        r.data.forEach(e => {\n          options.push({\n            id: e.id,\n            name: e.name\n          });\n        });\n      });\n\n      this.invoices.filters.waiter.options = options;\n    },\n    dataFilter(date){\n      let dateF = moment(date).format('YYYY-MM-DD');\n      this.meals.filters.date.date = dateF;\n      this.invoices.filters.date.date = dateF;\n      return dateF;\n    },\n    downloadInvoice(invoiceID){\n      InvoiceAPI.getDownloadPDF(invoiceID).then(r => {\n        if(r.status === 200){\n          let blob = new Blob([r.data], {type: 'application/pdf'});\n          let link = document.createElement('a');\n          link.href = window.URL.createObjectURL(blob);\n          link.download = 'invoice_'+ invoiceID +'.pdf';\n          link.click();\n          return;\n        }\n\n        toastr.error(\"There was an error while downloading your file\", \"ERROR\");\n      });\n    },\n    invoicesPaginate(direction){\n      if(direction === 'last'){\n        this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active,\n          true, true, true, this.invoices.data.current_page - 1, this.invoices.filters.date.date, this.invoices.filters.waiter.active.id);\n      }else{\n        this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active,\n          true, true, true, this.invoices.data.current_page + 1, this.invoices.filters.date.date, this.invoices.filters.waiter.active.id);\n      }\n    },\n\n  },\n  created(){\n    this.getInvoices(this.invoices.filters.state.active.length === 0 ? this.invoices.filters.state.options : this.invoices.filters.state.active,\n      true,\n      true,\n      true,\n      1,\n      null,\n      null\n    );\n  }\n};\n</script>\n\n<style scoped>\n  .align-bottom-right{\n    bottom: 20px;\n    right: 20px;\n    position: fixed !important;\n    z-index: 999;\n  }\n</style>\n"],"sourceRoot":"src/pages/Manager"}]}